(()=>{"use strict";const t=(e=class{constructor({id:t=null,...e}={}){var s,i;this.id=t,Object.assign(this,(s=this.constructor.properties,i=([t])=>[t,null],Object.fromEntries(Object.entries(s).map(i)))),this.assign_attributes(e)}static get _staticProperties(){return Object.prototype.hasOwnProperty.call(this,"__staticProperties")||(this.__staticProperties={id:0,all:{}}),this.__staticProperties}static get model(){return"Model"}static get id(){return this._staticProperties.id++}static create(t){const e=new this(t);return e.save(),e}static find(t){return this._staticProperties.all[t]}static delete(t){delete this._staticProperties.all[t],this.save()}delete(){this.constructor.delete(this.id)}assign_attributes(t){Object.assign(this,t)}update(t){return this.assign_attributes(t),this.save()}get errors(){return this._errors=this._errors||{}}validate(){this._errors=Object.fromEntries(Object.entries(this.constructor.properties).flatMap((([t,e])=>{const s=this[t],i=[];return null!==s&&s.constructor===e||i.push(`${s} is not of type ${e.name}`),i.length>0?[[t,i]]:[]})))}_appendError(t,e){this.errors[t]||(this.errors[t]=[]),this.errors[t].push(e)}get isValid(){return this.validate(),0===Object.keys(this.errors).length}static get all(){return this.load(),this._table}static get _table(){return Object.values(this._staticProperties.all)}},class extends e{static load(){if(!localStorage.getItem(this.model))return!1;this._staticProperties.all=function(){const t=JSON.parse(localStorage.getItem(this.model)).map((t=>[t.id,new this(t)]));return Object.fromEntries(t)}.call(this),this._staticProperties.id=this._table.reduce(((t,e)=>!isNaN(e.id)&&t<=e.id?e.id+1:t),0)}save(){return!!this.isValid&&(this.constructor.load(),null===this.id&&(this.id=this.constructor.id),this.constructor._staticProperties.all[this.id]=Object.assign(new this.constructor,this),this.constructor.save(),this)}static save(){localStorage.setItem(this.model,JSON.stringify(this._table))}});var e;const s=class extends t{static get model(){return"Project"}static get properties(){return{title:String}}buildTodo({...t}){return new i({...t,project_id:this.id})}get todos(){return i.all.filter((t=>t.project_id===this.id))}static delete(t){this.find(t).todos.forEach((t=>t.delete())),super.delete(t)}},i=class extends t{static get model(){return"Todo"}static get properties(){return{title:String,description:String,priority:String,project_id:Number}}get project(){return s.all.find((t=>t.id===this.project_id))}};localStorage.clear();const r=new s({title:"Lorem Ipsum"});r.save(),r.buildTodo({title:"Title",description:"description",priority:"low"}).save(),r.buildTodo({title:"Lorem Ipsum",description:"desc",priority:"medium"}).save(),r.delete();const o=new s({title:"Ipsum Lorem"});o.save(),o.buildTodo({title:"Title",description:"description",priority:"low"}).save(),console.table(i.all)})();
//# sourceMappingURL=main.js.map